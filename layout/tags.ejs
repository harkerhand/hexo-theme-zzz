<%
page.title = theme.tag && theme.tag.title || '标签'
page.subtitle = theme.tag && theme.tag.subtitle || '标签云'
page.banner_img = theme.tag && theme.tag.banner_img || theme.default_cover_image
%>

<!-- Banner Component -->
<%- partial('_partial/banner', {
  title: page.title,
  subtitle: page.subtitle,
  banner_img: url_handler(page.banner_img)
}) %>

<!-- Tags Content -->
<div class="content-container">
  <div class="tag-cloud">
    <% 
    var tagsData = [];
    site.tags.each(function(tag) {
      if (tag.posts.length > 0) {
        tagsData.push({
          name: tag.name,
          count: tag.posts.length,
          slug: tag.name.replace(/[^\u4e00-\u9fa5\w\s]/g, '').replace(/\s+/g, '-').toLowerCase()
        });
      }
    });
    
    // 计算标签云字体大小
    var maxCount = Math.max.apply(Math, tagsData.map(function(tag) { return tag.count; }));
    var minCount = Math.min.apply(Math, tagsData.map(function(tag) { return tag.count; }));
    var minFont = theme.tag.tagcloud.min_font || 15;
    var maxFont = theme.tag.tagcloud.max_font || 30;
    var unit = theme.tag.tagcloud.unit || 'px';
    
    // 预定义颜色数组
    var colors = ['#BBBBEE', '#9999DD', '#7777CC', '#5555BB', '#337ab7', '#225599', '#114488'];
    %>
    
    <% tagsData.forEach(function(tag) { %>
      <% 
      // 计算字体大小
      var fontSize = minFont;
      if (maxCount > minCount) {
        fontSize = minFont + (maxFont - minFont) * (tag.count - minCount) / (maxCount - minCount);
      }
      
      // 根据文章数量选择颜色
      var colorIndex = Math.min(Math.floor((tag.count - minCount) / Math.max(1, (maxCount - minCount)) * colors.length), colors.length - 1);
      var color = colors[colorIndex];
      %>
      <a href="<%= url_for('tags/' + tag.slug + '/') %>" 
         class="tag-cloud-item" 
         style="font-size: <%= Math.round(fontSize) %><%= unit %>; color: <%= color %>;"
         title="<%= tag.name %> (<%= tag.count %> 篇文章)">
        <%= tag.name %>
      </a>
    <% }); %>
  </div>
</div>
